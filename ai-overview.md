# AI Project Overview: Repository Security Scanner

## Architecture

This project is a server-side application built with [NestJS](https://nestjs.com/), designed to provide an API for scanning Git repositories for security issues. The codebase follows modular design principles, with each feature encapsulated in its own controller and service, adhering to NestJS best practices.

## Main Module

### AppModule
- **Location:** `src/app.module.ts`
- **Purpose:** The root module that registers the main controllers (`SecurityScanController`) and services (`SecurityScanService`).

### ConfigModule
- **Location:** `src/config/config.module.ts`
- **Purpose:** Provides configuration services via `ConfigService` and is imported by other modules for centralized configuration management.

## Controllers


### SecurityScanController
- **Location:** `src/security-scan.controller.ts`
- **Route:** `/scan`
- **Purpose:** Handles security scan requests for Git repositories.
- **Endpoints:**
  - `POST /scan`: Accepts a JSON body with a `repoUrl` field, triggers the security scan process, and returns structured results.

## Services


### SecurityScanService
- **Location:** `src/security-scan.service.ts`
- **Purpose:** Contains the business logic for:
  - Fetching repository metadata (currently mocked)
  - Running a security scan (currently mocked)
  - Logging raw scan output
  - Returning structured scan results
- **Key Methods:**
  - `scanRepository(repoUrl: string)`: Orchestrates the scan process and returns results.
  - `fetchRepoMetadata(repoUrl: string)`: (Mock) Returns repository name, description, default branch, last commit hash, and timestamp.

### ConfigService
- **Location:** `src/config/config.service.ts`
- **Purpose:** Placeholder for configuration logic. Currently empty, but intended for managing environment variables and app settings.

## Guards

### ApiKeyGuard
- **Location:** `src/api-key/api-key.guard.ts`
- **Purpose:** Protects endpoints by requiring a valid `X-API-KEY` header (`test-for-arnika-987`).
- **Usage:** Applied globally to all routes in `SecurityScanController`.

## API Endpoint

### POST /scan
- **Request Body:**
  ```json
  { "repoUrl": "https://github.com/example/repo" }
  ```
- **Response:**
  ```json
  {
    "repository": {
      "name": "mock-repo",
      "description": "A mock repository",
      "defaultBranch": "main",
      "lastCommit": {
        "hash": "abc123",
        "timestamp": "2024-01-01T00:00:00.000Z"
      }
    },
    "scanner": {
      "name": "MockScanner",
      "version": "1.0.0"
    },
    "findings": [
      {
        "ruleId": "SEC-001",
        "message": "Example hardcoded secret",
        "filePath": "src/example.ts",
        "line": 42,
        "severity": "HIGH"
      }
    ]
  }
  ```
- **Behavior:**
  - Accepts a Git repository URL.
  - Triggers the scan process.
  - Returns repository metadata, scanner info, and findings in a structured JSON format.
  - Logs raw scan output internally.

## Design Principles & Rules

- **DTO Usage:** All request/response data is wrapped in DTOs for validation and type safety.
- **Testing:** Unit and e2e tests are present for controllers and services. Test coverage is encouraged to be at least 80%.
- **Configuration:** Sensitive information should be managed via environment variables (future-proofed by `ConfigService`).
- **Separation of Concerns:** Controllers handle routing and validation; business logic resides in services.
- **Error Handling:** Controllers throw `NotFoundException` for missing resources; further error handling can be extended.
- **Naming Conventions:** Follows NestJS and TypeScript best practices for naming and file structure.

## Application Bootstrap

- **Entry Point:** `src/main.ts` bootstraps the NestJS application and listens on the port defined by `process.env.PORT` or defaults to 3000.

## Extensibility

- The modular structure allows for easy addition of new features, such as real Git metadata extraction, integration with real security scanners, authentication, or more advanced reporting.
- The current implementation uses placeholder/mock data for both metadata and scan results. It is ready to be extended with real logic as needed.

---

This overview was generated by AI based on the current project codebase. For more details, refer to the source files and inline documentation. 